---
title: 设计一个支持增量操作的栈
date: 2021-12-14 14:10:47
tags: [算法, codetop]
copyright: true
---
题目链接：
https://leetcode-cn.com/problems/design-a-stack-with-increment-operation/
解法分析：
1. 使用数组模拟堆栈（js 其实本来就常用这种操作）

```ts
class CustomStack {
    maxSize: number;
    stack: number[];

    constructor(maxSize: number) {
        this.maxSize = maxSize;
        this.stack = [];
    }

    push(x: number): void {
        if(this.stack.length < this.maxSize) {
            this.stack.push(x);
        }
    }

    pop(): number {
        if (this.stack.length === 0) {
            return -1;
        }
        return this.stack.pop();
    }

    increment(k: number, val: number): void {
        let needPop = Math.min(k, this.stack.length); // 需要弹出栈顶的元素数量

        for(let i = 0; i < needPop; i++) {
            this.stack[i] = this.stack[i] + val;
        }
    }
}

/**
 * Your CustomStack object will be instantiated and called as such:
 * var obj = new CustomStack(maxSize)
 * obj.push(x)
 * var param_2 = obj.pop()
 * obj.increment(k,val)
 */
```

2. increment 并不直接将 val 加到栈中，而是先记录 k 和 val，等到 pop 时再加入，时间复杂度优化到了 O(1)。这种解法实现的细节比较多，要小心 js 的 bug。详见注释。

```ts
class CustomStack {
    maxSize: number;
    stack: number[];
    incrementStack: number[];
    
    constructor(maxSize: number) {
        this.maxSize = maxSize;
        this.stack = [];
        this.incrementStack = new Array(maxSize).fill(0); // 此处必须全部初始化为 0
    }

    push(x: number): void {
        if(this.stack.length < this.maxSize) {
            this.stack.push(x);
        }
    }

    pop(): number {
        if (this.stack.length === 0) {
            return -1;
        }
        const len = this.stack.length;
        let popElem = this.stack.pop();
        if (this.incrementStack[len - 1]) {
            // 增加 increment 的值
            popElem += this.incrementStack[len - 1];
            // 因为每个 increment 都只有当前位置保存，为了不让信息丢失，所以此处要将 increment 的值传递给下一位。
            this.incrementStack[len - 2] += this.incrementStack[len - 1];
            this.incrementStack[len - 1] = 0;
        }

        return popElem;
    }

    increment(k: number, val: number): void {
        const needPop = Math.min(k, this.stack.length);
        this.incrementStack[needPop - 1] += val;
    }
}

/**
 * Your CustomStack object will be instantiated and called as such:
 * var obj = new CustomStack(maxSize)
 * obj.push(x)
 * var param_2 = obj.pop()
 * obj.increment(k,val)
 */
```